<?php
// Lista de atividades
$atividades = [
    "Aplicar modelo MVC como padrão de desenvolvimento de software",
    "Configurar acesso da rede sem fio por endereço de MAC",
    "Configurar redes sem fio",
    "Cria banners",
    "Criar algoritmos através de divisão modular",
    "Criar algoritmos através de refinamentos sucessivos",
    "Criar animações com Scratch",
    "Criar animações multimídia",
    "Criar aplicações em linguagem de programação compatíveis com o paradigma de orientação a objetos",
    "Criar aplicações para atualização de dados",
    "Criar aplicações para consulta de dados",
    "Criar aplicações para exclusão de dados",
    "Criar aplicações para inserção de dados",
    "Criar aplicações para leitura de dados",
    "Criar aplicativos Web baseados em dispositivos móveis",
    "Criar artes gráficas",
    "Criar atributos",
    "Criar diagrama do modelo relacional",
    "Criar diagramas UML básicos",
    "Criar diretórios",
    "Criar entidades",
    "Criar estrutura dos elementos de estilização do formulário",
    "Criar folders",
    "Criar folha de estilo em CSS",
    "Criar formulários para página Web",
    "Criar formulários para Web",
    "Criar formulas condicionais",
    "Criar gráficos",
    "Criar instruções SQL DDL",
    "Criar instruções SQL DML",
    "Criar jogos educativos com Scratch",
    "Criar jogos multiplataformas",
    "Criar layout de páginas usando CSS – Cascading Style Sheets",
    "Criar material publicitário",
    "Criar modelagem conceitual do banco de dados",
    "Criar Modelagem de Entidade-Relacionamento para o DER",
    "Criar modelagem lógica de banco de dados",
    "Criar normalização de tabelas do banco de dados",
    "Criar páginas para upload de arquivos",
    "Criar partições para o sistema de arquivo",
    "Criar planilhas eletrônicas",
    "Criar programas em linguagem de programação",
    "Criar programas usando conceitos básicos de programação",
    "Criar proteção para planilha",
    "Criar relacionamentos",
    "Criar scripts em linguagem de programação usando os fundamentos de estruturas lógicas",
    "Criar scripts para manipular serviços de rede de comunicação",
    "Criar sequência de passos de processos",
    "Criar sistemas integrando o banco de dados com aplicação",
    "Criar sistemas nas camadas propostas pelo padrão MVC",
    "Criar tabelas",
    "Criar um CRUD em linguagem de programação",
    "Criar Websites dinâmicos",
    "Desenvolver apresentações eletrônicas",
    "Desenvolver layout",
    "Editar imagens no CorelDRAW",
    "Editar planilhas eletrônicas",
    "Emitir laudos técnicos de computadores",
    "Emitir laudos técnicos de periféricos",
    "Estabelecer comunicação entre computadores",
    "Exportar imagens no CorelDRAW",
    "Importar imagens no CorelDRAW",
    "Inserir paginação",
    "Instalar sistemas Dual Boot",
    "Instalar softwares essenciais",
    "Manipular imagens no CorelDRAW",
    "Realizar a instalação dos drivers",
    "Realizar aplicação de folhas de estilo para formatação de páginas",
    "Realizar aplicação de permissões em arquivos",
    "Realizar aplicação de permissões em diretórios",
    "Realizar apresentações digitais",
    "Realizar ativação dos softwares essenciais",
    "Realizar backup de arquivos",
    "Realizar compartilhamento de arquivos",
    "Realizar compartilhamento de impressoras",
    "Realizar configuração de bordas",
    "Realizar configuração de computador em rede",
    "Realizar configuração de gerenciador de e-mails",
    "Realizar configuração de margens",
    "Realizar configuração de rede",
    "Realizar correção de erros de sintaxe de linguagem de programação",
    "Realizar correção de erros em diagramas propostos",
    "Realizar crimpagem dos conectores em cabo UTP",
    "Realizar desfragmentação de arquivos no disco",
    "Realizar desmontagem de computadores",
    "Realizar edição de textos",
    "Realizar encaixe de elementos na estrutura do código em linguagem de programação",
    "Realizar encaixe de elementos na estrutura dos algoritmos",
    "Realizar encaixe de elementos na estrutura dos programas",
    "Realizar encaixe de periféricos",
    "Realizar encaixe de tags na estrutura HTML",
    "Realizar escolha da estrutura de dados",
    "Realizar escolha de estilos de formatação de página Web",
    "Realizar escolha de normas de validação de páginas",
    "Realizar escolha de sistema operacional de acordo com arquitetura computacional",
    "Realizar formatação de textos",
    "Realizar formatação para o disco/partição",
    "Realizar gerenciamento de dispositivos",
    "Realizar gerenciamento de sistemas de banco de dados",
    "Realizar gerenciamento do Sistema Operacional",
    "Realizar identificação de requisitos para sistema proposto",
    "Realizar instalação de impressoras",
    "Realizar instalação de Sistema Operacional",
    "Realizar instalação de softwares anti-malware",
    "Realizar instalação de softwares antivírus",
    "Realizar integração entre classes e pacotes",
    "Realizar integração entre e o SGBD",
    "Realizar interligação de sistemas de banco de dados com aplicações",
    "Realizar interpretação de algoritmos",
    "Realizar interpretação de diagramas UML básicos",
    "Realizar interpretação de símbolos",
    "Realizar leitura de algoritmos",
    "Realizar leitura de símbolos",
    "Realizar levantamento de requisitos",
    "Realizar limpeza interna no gabinete",
    "Realizar manipulação de arquivos",
    "Realizar manipulação de diretórios",
    "Realizar manipulação de pastas",
    "Realizar manuseio de alicate",
    "Realizar manuseio de alicates de crimpagem e punch down",
    "Realizar manuseio de chaves de fenda",
    "Realizar manuseio de chaves Philips",
    "Realizar manuseio de testador de cabo",
    "Realizar manutenção corretiva em microcomputadores",
    "Realizar manutenção preventiva em microcomputadores",
    "Realizar mapeamento de classes necessárias a um software",
    "Realizar mapeamento de entidades",
    "Realizar minicursos de informática básica",
    "Realizar modificações a partir de um programa já implementado",
    "Realizar montagem de computadores",
    "Realizar operação de S.O. (Sistema Operacional)",
    "Realizar operação de um S.O. (Sistema Operacional) em modo texto",
    "Realizar operações com arquivos no servidor Web",
    "Realizar operações com diretórios no servidor Web",
    "Realizar planejamento de rede",
    "Realizar testes de comunicação com rede de computadores",
    "Realizar testes em produtos de software",
    "Realizar tratamento de imagens no Photoshop",
    "Realizar verificação de compatibilidade de hardware",
    "Salvar imagens no CorelDRAW",
    "Utilizar algoritmos",
    "Utilizar CD/DVD",
    "Utilizar comandos e funções no MS-DOS",
    "Utilizar discos removíveis",
    "Utilizar efeitos nas apresentações",
    "Utilizar função PROCH",
    "Utilizar função PROCV",
    "Utilizar funções básicas do Scratch",
    "Utilizar gerenciadores no Linux",
    "Utilizar gerenciadores no Windows",
    "Utilizar linguagem HTML na criação de páginas Web",
    "Utilizar mala direta",
    "Utilizar operadores de comparação",
    "Utilizar operadores matemáticos",
    "Utilizar pacote de escritório",
    "Utilizar plataforma Android",
    "Utilizar plataforma Android SDK",
    "Utilizar plataforma Android Studio",
    "Utilizar programação em bloco com auxílio do Scratch",
    "Utilizar softwares anti-malware",
    "Utilizar Unity como Gamer Engine",
    "Vetorizar imagens"
];

// Check if the form was submitted
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    // Get form data
    $escola = isset($_POST['escola']) ? htmlspecialchars($_POST['escola']) : '';
    $nome = isset($_POST['nome']) ? htmlspecialchars($_POST['nome']) : '';
    $telefone = isset($_POST['telefone']) ? htmlspecialchars($_POST['telefone']) : '';
    $curso = isset($_POST['curso']) ? htmlspecialchars($_POST['curso']) : '';
    $disciplina = isset($_POST['disciplina']) ? htmlspecialchars($_POST['disciplina']) : '';
    $satisfacao_curso = isset($_POST['satisfacao_curso']) ? $_POST['satisfacao_curso'] : '';
    $expectativas = isset($_POST['expectativas']) ? $_POST['expectativas'] : '';
    $recomendacao = isset($_POST['recomendacao']) ? $_POST['recomendacao'] : '';
    $data_hora = date('Y-m-d H:i:s');
    
    // Processar atividades
    $atividades_respostas = array_fill(0, count($atividades), ''); // Inicializa com strings vazias
    
    foreach ($_POST as $key => $value) {
        if (strpos($key, 'atividade_') === 0) {
            $index = intval(str_replace('atividade_', '', $key));
            if (isset($atividades_respostas[$index])) {
                $atividades_respostas[$index] = htmlspecialchars($value);
            }
        }
    }
    
    // CSV Data - Inicializa com os campos básicos
    $data = array(
        'Data' => date('Y-m-d H:i:s'),
        'Escola' => $escola,
        'Nome' => $nome,
        'Telefone' => $telefone,
        'Curso' => $curso,
        'Disciplina' => $disciplina,
        // 'Satisfação com o Curso' => $satisfacao_curso,
        // 'Expectativas Atendidas' => $expectativas
    );
    
    // Adicionar respostas das atividades com os nomes das atividades como chaves
    foreach ($atividades as $index => $atividade) {
        $data[$atividade] = isset($atividades_respostas[$index]) ? $atividades_respostas[$index] : '';
    }
    
    // Open the file for appending
    $file = 'dados_alunos.csv';
    $file_exists = file_exists($file);
    $handle = fopen($file, 'a');
    
    // If file is empty, add UTF-8 BOM and header
    if (!$file_exists || filesize($file) == 0) {
        // Add UTF-8 BOM for proper Excel encoding
        fputs($handle, "\xEF\xBB\xBF");
        
        // Criar array associativo com todos os cabeçalhos
        $header = array(
            'Data' => 'Data',
            'Escola' => 'Escola',
            'Nome' => 'Nome',
            'Telefone' => 'Telefone',
            'Curso' => 'Curso',
            'Disciplina' => 'Disciplina',
            // 'Satisfação com o Curso' => 'Satisfação com o Curso',
            // 'Expectativas Atendidas' => 'Expectativas Atendidas'
        );
        
        // Adicionar cabeçalhos das atividades
        foreach ($atividades as $atividade) {
            $header[$atividade] = $atividade;
        }
        
        // Escrever cabeçalhos
        fputcsv($handle, array_keys($header), ';');
    }
    
    // Escrever os dados, garantindo a mesma ordem dos cabeçalhos
    $row = [];
    foreach ($header as $key => $value) {
        $row[] = isset($data[$key]) ? $data[$key] : '';
    }
    fputcsv($handle, $row, ';');
    fclose($handle);
    
    // Redirect back with success message
    header('Location: index.php?status=success');
    exit();
} else {
    // If not a POST request, redirect to the form
    header('Location: index.php');
    exit();
}
?>
